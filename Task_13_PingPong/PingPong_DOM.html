<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>PingPong_Dom</title>
    <style>
        * {
            margin: 0px;
            padding: 0px;
        }

        body {
            margin: 50px;
            padding: 0px;
        }
    </style>
</head>

<body>



    <script>
        "use strict";
        //wrapper
        var wrapper = document.createElement('div');
        document.body.append(wrapper);
        wrapper.style.width = '600px';
        //button
        var start = document.createElement('input');
        start.type = "button";
        start.value = "start!";
        start.style.position = 'absolute';
        start.style.top = '75px';
        start.style.width = '60px';
        wrapper.appendChild(start);
        start.onclick = gameStart;
        //score
        var score = document.createElement('div'),
            score1 = 0,
            score2 = 0;
        scoreInnerHTML();
        score.style.margin = '10px auto 10px auto';
        score.style.width = '100px';
        score.style.fontSize = '32px';
        score.style.textAlign = 'center';
        wrapper.appendChild(score);
        function scoreInnerHTML() {
            score.innerHTML = score1 + ":" + score2;
        }
        //field
        var field = document.createElement('div');
        field.style.width = '600px';
        field.style.height = '400px';
        field.style.border = '1px solid';
        field.style.backgroundColor = 'yellow';
        field.style.left = '0px';
        field.style.top = '30px';
        wrapper.appendChild(field);
        //paddles
        var paddle1 = document.createElement('div');
        var paddle2 = document.createElement('div');
        paddle1.style.width = '10px';
        paddle1.style.height = '100px';
        paddle1.style.backgroundColor = 'green';
        paddle1.style.position = 'absolute';
        paddle2.style.width = '10px';
        paddle2.style.height = '100px';
        paddle2.style.backgroundColor = 'blue';
        paddle2.style.position = 'absolute';
        field.appendChild(paddle2);
        field.appendChild(paddle1);
        //ball
        var ball = document.createElement('div');
        ball.style.width = '30px';
        ball.style.height = '30px';
        ball.style.borderRadius = '50%';
        ball.style.backgroundColor = 'red';
        ball.style.position = 'absolute';
        field.appendChild(ball);
        //message
        var message = document.createElement('div'),
            messageText = 'GOAL!';
        message.style.fontSize = '50px';
        message.style.color = 'red';
        message.style.textAlign = 'center';
        field.appendChild(message);
        var game;
        let paddlesPos = {
            paddle1X: field.getBoundingClientRect().left + 1,
            paddle1Y: field.getBoundingClientRect().top + field.getBoundingClientRect().height / 2 - parseInt(paddle2.style.height) / 2 + 1,
            paddle2X: field.getBoundingClientRect().left + field.getBoundingClientRect().width - parseInt(paddle2.style.width) - 1,
            paddle2Y: field.getBoundingClientRect().top + field.getBoundingClientRect().height / 2 - parseInt(paddle2.style.height) / 2 + 1,
            paddle1Move: 0,
            paddle2Move: 0,
            update: function () {
                paddle1.style.left = paddlesPos.paddle1X + 'px';
                paddle1.style.top = paddlesPos.paddle1Y + 'px';
                paddle2.style.left = paddlesPos.paddle2X + 'px';
                paddle2.style.top = paddlesPos.paddle2Y + 'px';
            },
        }
        paddlesPos.update();
        var ballPos = {
            ballX: field.getBoundingClientRect().left + field.getBoundingClientRect().width / 2 - ball.getBoundingClientRect().width / 2 - 1,
            ballY: field.getBoundingClientRect().top + field.getBoundingClientRect().height / 2 - ball.getBoundingClientRect().height / 2 - 1,
            moveX: 0,
            moveY: 0,
            update: function () {
                ball.style.left = ballPos.ballX + 'px';
                ball.style.top = ballPos.ballY + 'px';
            },
        }
        ballPos.update();

        function gameStart() {
            ballPos.moveX = 4;
            ballPos.moveY = 1;
        }

        window.addEventListener("keydown", function (EO) {
            EO = EO || window.event;
            EO.preventDefault();

            if (EO.keyCode === 17) {
                paddlesPos.paddle1Move = 1;
            }

            if (EO.keyCode === 16) {
                paddlesPos.paddle1Move = -1;
            }

            if (EO.keyCode === 40) {
                paddlesPos.paddle2Move = 1;
            }

            if (EO.keyCode === 38) {
                paddlesPos.paddle2Move = -1;
            }
        });
        window.addEventListener("keyup", function (EO) {
            EO = EO || window.event;
            EO.preventDefault();

            if (EO.keyCode === 17) {
                paddlesPos.paddle1Move = 0;
            }

            if (EO.keyCode === 16) {
                paddlesPos.paddle1Move = 0;
            }

            if (EO.keyCode === 40) {
                paddlesPos.paddle2Move = 0;
            }

            if (EO.keyCode === 38) {
                paddlesPos.paddle2Move = 0;
            }
        });
        function initPosition() {
            message.innerHTML = "";
            paddlesPos.paddle1X = field.getBoundingClientRect().left + 1;
            paddlesPos.paddle1Y = field.getBoundingClientRect().top + field.getBoundingClientRect().height / 2 - parseInt(paddle2.style.height) / 2 + 1;
            paddlesPos.paddle2X = field.getBoundingClientRect().left + field.getBoundingClientRect().width - parseInt(paddle2.style.width) - 1;
            paddlesPos.paddle2Y = field.getBoundingClientRect().top + field.getBoundingClientRect().height / 2 - parseInt(paddle2.style.height) / 2 + 1;
            ballPos.ballX = field.getBoundingClientRect().left + field.getBoundingClientRect().width / 2 - ball.getBoundingClientRect().width / 2 - 1;
            ballPos.ballY = field.getBoundingClientRect().top + field.getBoundingClientRect().height / 2 - ball.getBoundingClientRect().height / 2 - 1;

        }
        function game() {
            ballPos.update();
            paddlesPos.update();
            ballPos.ballX -= ballPos.moveX;
            ballPos.ballY -= ballPos.moveY;
            function delay() {
                cancelAnimationFrame(game);
                window.setTimeout(function () {
                    initPosition();
                    gameStart();
                }, 1500);
            }
            (paddlesPos.paddle1Y <= field.getBoundingClientRect().top) ? paddlesPos.paddle1Y = field.getBoundingClientRect().top : paddlesPos.paddle1Y += paddlesPos.paddle1Move;
            (paddlesPos.paddle1Y + parseInt(paddle1.style.height) > field.getBoundingClientRect().bottom) ? paddlesPos.paddle1Y = field.getBoundingClientRect().bottom - parseInt(paddle1.style.height) : paddlesPos.paddle1Y += paddlesPos.paddle1Move;
            (paddlesPos.paddle2Y <= field.getBoundingClientRect().top - paddlesPos.paddle2Move) ? paddlesPos.paddle2Y = field.getBoundingClientRect().top : paddlesPos.paddle2Y += paddlesPos.paddle2Move;
            (paddlesPos.paddle2Y + parseInt(paddle1.style.height) > field.getBoundingClientRect().bottom) ? paddlesPos.paddle2Y = field.getBoundingClientRect().bottom - parseInt(paddle1.style.height) : paddlesPos.paddle2Y += paddlesPos.paddle2Move;

            if (ballPos.ballX >= field.getBoundingClientRect().left + field.getBoundingClientRect().width - parseInt(ball.style.width)) {
                score2 += 1;
                scoreInnerHTML();
                ballPos.moveX = 0;
                ballPos.moveY = 0;
                message.innerHTML = messageText;
                ballPos.ballX = field.getBoundingClientRect().left + field.getBoundingClientRect().width - parseInt(ball.style.width) - 1;
                delay();
            }
            else if ((ballPos.ballY < paddlesPos.paddle1Y + parseInt(paddle1.style.height) && ballPos.ballY + parseInt(ball.style.height) > paddlesPos.paddle1Y) && (ballPos.ballX <= paddlesPos.paddle1X + parseInt(paddle1.style.width))) {
                ballPos.moveX = -ballPos.moveX;

            }
            if (ballPos.ballX < field.getBoundingClientRect().left) {
                score1 += 1;
                scoreInnerHTML();
                ballPos.moveX = 0;
                ballPos.moveY = 0;
                message.innerHTML = messageText;
                ballPos.ballX = field.getBoundingClientRect().left + 1;
                delay();
            }

            else if ((ballPos.ballY < paddlesPos.paddle2Y + parseInt(paddle1.style.height) && ballPos.ballY + parseInt(ball.style.height) > paddlesPos.paddle2Y) && (ballPos.ballX + parseInt(ball.style.width) > paddlesPos.paddle2X)) {
                ballPos.moveX = -ballPos.moveX;
            }
            if (ballPos.ballY >= field.getBoundingClientRect().top + field.getBoundingClientRect().height - parseInt(ball.style.width) - 1) {
                ballPos.moveY = -ballPos.moveY;
            }
            if (ballPos.ballY < field.getBoundingClientRect().top + 1) {
                ballPos.moveY = -ballPos.moveY;
            }
            paddlesPos.update();
            requestAnimationFrame(game);
        }
        requestAnimationFrame(game);

    </script>
</body>

</html>